

@{
    ViewBag.Title = "Ajax";
    ViewBag.SubTitle = "DataTables";
}


  <!-- Datatables css -->
<link href="~/plugins/datatables/responsive.bootstrap5.min.css" rel="stylesheet" type="text/css">
<link href="~/plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css">



<div class="container-fluid">
    @await Html.PartialAsync("~/Views/Shared/Partials/_PageTitle.cshtml")
    <div class="card-body">
        <p class="text-muted" id="ListName" name=@ViewBag.dataSource>
            @ViewBag.dataSource
        </p>

        <ul class="nav nav-tabs nav-bordered nav-bordered-primary mb-3">
            <li class="nav-item">
                <a href="#home-b2" data-bs-toggle="tab" aria-expanded="true" class="nav-link active">
                    <i class="ti ti-home fs-lg me-md-1 align-middle"></i>
                    <span class="d-none d-md-inline-block align-middle">USERS</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#profile-b2" data-bs-toggle="tab" aria-expanded="true" class="nav-link">
                    <i class="ti ti-user-circle fs-lg me-md-1 align-middle"></i>
                    <span class="d-none d-md-inline-block align-middle">ROLES</span>
                </a>
            </li>
            
        </ul>

        <div class="tab-content">
            <div class="tab-pane show active" id="home-b2">

                 <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header justify-content-between">
                                <h4 class="card-title"> USER-ROSTER MANAGEMENT </h4>
                            </div>

                            <div class="card-body">
                                <table id="datatables-ajax" class="table table-striped dt-responsive align-middle mb-0">
                                    <thead class="thead-sm text-uppercase fs-xxs">
                                        <tr>
                                            <th></th>
                                            <th style="text-align: left;">Username</th>
                                            <th style="text-align: left;">Name</th>
                                            <th style="text-align: left;">Roles</th>
                                            <th style="text-align: left;">ContactInfo</th>
                                            <th style="text-align: left;">Schedule</th>
                                            <th style="text-align: left;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                    <tfoot>
                                        
                                    </tfoot>
                                </table>
                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div>
                </div>

            </div>
            <div class="tab-pane" id="profile-b2">
                <p class="mb-0">Hi there! I'm an avid explorer with a passion for technology, fitness, and continuous learning. I enjoy meeting like-minded individuals and believe in expanding my knowledge on diverse subjects, from the latest gadgets to personal development.</p>
            </div>
            
        </div>

    </div> <!-- end card body-->
</div>


<!-- Datatables js -->
<script src="~/plugins/datatables/dataTables.min.js"></script>
<script src="~/plugins/datatables/dataTables.bootstrap5.min.js"></script>
<script src="~/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="~/plugins/datatables/responsive.bootstrap5.min.js"></script>


<script>
    
    $(document).ready(function(){

        function format(d) {
    // `d` is the original data object for the row
            let html = '';
            if (Array.isArray( d.ContactInfo)) {
                 d.ContactInfo.forEach((item, index) => {
                html += `<div class="col col-lg-4">
                        <ul>`;
                for (const key in item) {
                    if (item.hasOwnProperty(key)) {
                        html += `<li>${key}: ${item[key]}</li>`;
                    }
                }
                html += `</ul></div>`;
                });
            }
            return html;
            
        }

        const tableElement = document.getElementById('datatables-ajax')
        if (tableElement) {
            const table = new DataTable(tableElement, {
                ajax: 'http://localhost:9089/system/webdev/Main/API/Users/getUserList?ListName='+ $("[id='ListName']").attr('name') +'',
                processing: true,
                serverSide: true,
                processData: false,
                order: [[1, 'desc']],
                columns: [
                    {
                        className: 'dt-control dt-child-rows-btn',
                        orderable: false,
                        data: null,
                        defaultContent: '<i class="dt-control dt-child-rows-btn ti ti-square-rounded-plus-filled text-primary align-middle fs-22"></i>'
                    },
                    {data: 'Username'},
                    {data: 'Name'},
                    {data: 'Roles'},
                    {data: 'ContactInfo', visible: false,},
                    {data: 'Schedule'},
                    {
                        data: 'Username',
                        render: (data, type, row) => {
                            return `<div class="d-flex justify-content-center gap-1">
                                        <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle"><i class="ti ti-eye fs-lg"></i></a>
                                        <a href="#" class="btn btn-light btn-icon btn-sm rounded-circle"><i class="ti ti-edit fs-lg"></i></a>
                                        <a href="#" data-table-delete-row="" class="btn btn-danger btn-icon btn-sm rounded-circle"><i class="ti ti-trash fs-lg"></i></a>
                                    </div>`;

                        }
                    }
                ],
                language: {
                    paginate: {
                        first: '<i class="ti ti-chevrons-left"></i>',
                        previous: '<i class="ti ti-chevron-left"></i>',
                        next: '<i class="ti ti-chevron-right"></i>',
                        last: '<i class="ti ti-chevrons-right"></i>'
                    },
                    lengthMenu: '_MENU_ Companies per page',
                    info: 'Showing <span class="fw-semibold">_START_</span> to <span class="fw-semibold">_END_</span> of <span class="fw-semibold">_TOTAL_</span> Name'
                }
            });

            table.on('click', 'tbody td.dt-control', function (e) {
                let tr = e.target.closest('tr');
                let row = table.row(tr);

                if (row.child.isShown()) {
                    row.child.hide();
                } else {
                    row.child(format(row.data())).show();
                }
            });
        }
       

        $('#datatables-ajax tbody').on('click', '.dropdown-item', function () {
            const id = $(this).attr('name');
            alert(id);
            //event.preventDefault();
            //clearInterval();        
            //$("[id='page']").load("@Url.Action("UsersList", "UsersIgnition")", {dataSource: id});
        });
    });
</script>